<!-- Floating Home Button -->
<button id="homePanelBtn" class="btn btn-primary position-fixed rounded-circle">
  <i class="bi bi-arrow-up"></i>
</button>

<script>
  console.log("Header section loaded");
</script>

<!-- Left Offcanvas Navigation -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="navOffcanvas">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title"><i class="bi bi-shop me-2"></i></h5>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="offcanvas"
    ></button>
  </div>
  <div class="offcanvas-body">
    <ul class="nav flex-column">
      <li class="nav-item">
        <a class="nav-link" href="index.html" data-i18n="home">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="index.html#products" data-i18n="products"
          >Products</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link" href="pages/orders.html" data-i18n="orders"
          >Orders</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link" href="pages/contact.html" data-i18n="contact"
          >Contact</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link" href="pages/faq.html" data-i18n="faqs">FAQs</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="pages/support.html" data-i18n="support"
          >Support</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link" href="pages/admin.html" data-i18n="admin">Admin</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="pages/about.html" data-i18n="about">About</a>
      </li>
    </ul>
  </div>
</div>

<!-- Navigation -->
<nav id="mainNavbar" class="navbar navbar-light bg-white shadow-sm fixed-top">
  <!-- Brand Row (xs only) -->
  <div class="container d-sm-none">
    <div class="d-flex justify-content-center py-2">
      <a
        class="navbar-brand fw-bold text-primary"
        href="index.html"
        style="font-size: 1.5rem"
      >
        <i class="bi bi-shop me-2"></i>POStore
      </a>
    </div>
  </div>

  <!-- Main Row -->
  <div class="container">
    <div class="d-flex align-items-center justify-content-between w-100">
      <!-- Brand (sm+ only) -->
      <a
        class="navbar-brand fw-bold text-primary d-none d-sm-block"
        href="index.html"
        style="font-size: 1.5rem"
      >
        <i class="bi bi-shop me-2"></i>POStore
      </a>

      <!-- Right side: Search + Cart + Wishlist (sm+ only) -->
      <div class="d-sm-flex align-items-center">
        <!-- Search Bar -->
        <div class="input-group me-3 mb-2" style="max-width: 300px">
          <input
            type="text"
            class="form-control"
            placeholder="Search products..."
            id="searchInputDesktop"
            data-i18n="search_placeholder"
          />
          <button
            class="btn btn-outline-primary"
            type="button"
            id="searchBtnDesktop"
          >
            <i class="bi bi-search"></i>
          </button>
        </div>

        <!-- Language Switcher -->
        <div class="btn-group me-3 mb-2" role="group">
          <button
            type="button"
            class="btn btn-outline-secondary"
            id="lang-en"
            data-language="en"
          >
            EN
          </button>
          <button
            type="button"
            class="btn btn-outline-secondary"
            id="lang-es"
            data-language="es"
          >
            ES
          </button>
        </div>

        <!-- Cart and Wishlist -->
        <button
          class="btn btn-primary position-relative me-2 mb-2"
          data-bs-toggle="offcanvas"
          data-bs-target="#cartOffcanvas"
        >
          <i class="bi bi-cart3"></i>
          <span
            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
            id="cartCount"
            >0</span
          >
        </button>
        <button
          class="btn btn-outline-primary position-relative me-2 mb-2"
          data-bs-toggle="offcanvas"
          data-bs-target="#wishlistOffcanvas"
        >
          <i class="bi bi-heart"></i>
          <span
            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
            id="wishlistCount"
            >0</span
          >
        </button>
        <!-- Hamburger Menu for Navigation Links -->
        <button
          class="btn btn-outline-secondary d-lg-none"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#navOffcanvas"
        >
          <i class="bi bi-list"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Bottom Row: Navigation Links (desktop only) -->
  <div class="container-fluid bg-light border-top d-none d-lg-block">
    <div class="container">
      <ul class="nav py-2">
        <li class="nav-item">
          <a class="nav-link" href="index.html" data-i18n="home">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="index.html#products" data-i18n="products"
            >Products</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="pages/orders.html" data-i18n="orders"
            >Orders</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="pages/contact.html" data-i18n="contact"
            >Contact</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="pages/faq.html" data-i18n="faqs">FAQs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="pages/support.html" data-i18n="support"
            >Support</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="pages/admin.html" data-i18n="admin"
            >Admin</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="pages/about.html" data-i18n="about"
            >About</a
          >
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
  // Set business name after business data is loaded
  function updateBusinessName() {
    const businessName = window.globalStore?.state?.BusinessName || "POStore";
    const titleElement = document.querySelector(
      "#navOffcanvas .offcanvas-title i"
    );
    if (titleElement) {
      titleElement.parentElement.innerHTML = `<i class="bi bi-shop me-2"></i>${businessName}`;
    }

    // Update all navbar brand elements
    const navbarBrands = document.querySelectorAll(".navbar-brand");
    navbarBrands.forEach((brand) => {
      brand.innerHTML = `<i class="bi bi-shop me-2"></i>${businessName}`;
    });
  }

  // Listen for business data loaded event
  window.addEventListener("businessDataLoaded", updateBusinessName);

  // Also check if business data is already loaded
  document.addEventListener("DOMContentLoaded", function () {
    if (window.businessDataReady && window.globalStore?.state?.BusinessName) {
      updateBusinessName();
    }
  });

  // Language switching functionality
  function setupLanguageSwitching() {
    console.log("setupLanguageSwitching called");
    const langEnBtn = document.getElementById("lang-en");
    const langEsBtn = document.getElementById("lang-es");
    console.log("Language buttons found:", !!langEnBtn, !!langEsBtn);
    if (!langEnBtn || !langEsBtn) {
      console.error(
        "Language buttons not found, exiting setupLanguageSwitching"
      );
      return;
    }

    // Set initial active language button
    const currentLanguage = localStorage.getItem("language") || "en";
    console.log("Current language from localStorage:", currentLanguage);
    if (currentLanguage === "es") {
      console.log("Setting ES button as active");
      langEsBtn.classList.remove("btn-outline-secondary");
      langEsBtn.classList.add("btn-secondary");
    } else {
      console.log("Setting EN button as active");
      langEnBtn.classList.remove("btn-outline-secondary");
      langEnBtn.classList.add("btn-secondary");
    }

    // Add event listeners to language buttons
    langEnBtn.addEventListener("click", function () {
      console.log("EN button clicked");
      console.log("Current window.i18n:", typeof window.i18n);
      // Update button styles
      console.log("Updating EN button styles");
      langEnBtn.classList.remove("btn-outline-secondary");
      langEnBtn.classList.add("btn-secondary");
      console.log("Updating ES button styles");
      langEsBtn.classList.remove("btn-secondary");
      langEsBtn.classList.add("btn-outline-secondary");

      // Change language
      if (typeof window.i18n !== "undefined") {
        console.log("Using i18n.changeLanguage");
        window.i18n.changeLanguage("en");
      } else {
        console.log("Using window.dispatchEvent fallback");
        // Fallback if i18n is not available yet
        window.dispatchEvent(
          new CustomEvent("languageChange", { detail: { language: "en" } })
        );
      }
    });

    langEsBtn.addEventListener("click", function () {
      console.log("ES button clicked");
      console.log("Current window.i18n:", typeof window.i18n);
      // Update button styles
      console.log("Updating ES button styles");
      langEsBtn.classList.remove("btn-outline-secondary");
      langEsBtn.classList.add("btn-secondary");
      console.log("Updating EN button styles");
      langEnBtn.classList.remove("btn-secondary");
      langEnBtn.classList.add("btn-outline-secondary");

      // Change language
      if (typeof window.i18n !== "undefined") {
        console.log("Using i18n.changeLanguage");
        window.i18n.changeLanguage("es");
      } else {
        console.log("Using window.dispatchEvent fallback");
        // Fallback if i18n is not available yet
        window.dispatchEvent(
          new CustomEvent("languageChange", { detail: { language: "es" } })
        );
      }
    });
  }

  // Set up language switching when DOM is loaded
  document.addEventListener("DOMContentLoaded", function () {
    console.log("DOMContentLoaded event fired for language switching");
    // Small delay to ensure i18n is initialized
    console.log("Setting timeout for setupLanguageSwitching");
    setTimeout(function () {
      console.log("setTimeout executed, calling setupLanguageSwitching");
      setupLanguageSwitching();
    }, 100);
  });

  // Also set up language switching when section is loaded
  document.addEventListener("sectionLoaded", function (e) {
    if (e.detail.id === "headerSection") {
      console.log("Header section loaded, setting up language switching");
      // Small delay to ensure i18n is initialized
      setTimeout(function () {
        console.log("Calling setupLanguageSwitching for header section");
        setupLanguageSwitching();
      }, 100);
    }
  });
</script>
